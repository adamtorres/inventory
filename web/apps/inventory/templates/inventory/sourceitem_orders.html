{% extends "base.html" %}
{% load static %}
{% load humanize %}

{% block title %}Source Items Orders{% endblock %}

{% block styles %}
<style>
.choice-filter {

}
.choice-filter-comment {
    color: lightgray;
}
.choice-inline {
    display: inline-block;
}
</style>
{% endblock %}

{% block content %}
<div class="accordion" id="filter-limits-parent">
    <div class="accordion-item">
        <h2 class="accordion-header" id="filter-limits-heading">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#filter-limits-collapsible" aria-expanded="false" aria-controls="filter-limits-collapsible">
                Limit by Source or Category
            </button>
        </h2>
        <div id="filter-limits-collapsible" class="accordion-collapse collapse" aria-labelledby="filter-limits-heading" data-bs-parent="#filter-limits-parent">
            <div class="accordion-body">
                <div>
                    <div>
                        <span class="choice-filter">Limit to selected source(s) </span>
                        <span class="choice-filter-comment">or select none for no filter</span>
                    </div>
                    <div class="choice-inline">
                        {% for source in sources %}
                            <div class="choice-inline" style="margin-right: 2em;">
                                <div class="choice-inline">
                                    <input type="checkbox" name="filter-source" id="filter-source-{{ source.id }}" value="{{ source.id }}">
                                </div>
                                <div class="choice-inline">
                                    <label for="filter-source-{{ source.id }}">{{ source.name|title }}</label>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<table style="display: none;" class="filtered-order-template-container">
    <tr id="filtered-order-template" class="order-row" data-source-id="nope" data-delivered-date="nope" data-order-number="nope" data-order-url="nope">
        <td><span data-field="id">__id__</span><span data-field="source_name">__source_name__</span></td>
        <td><span data-field="delivered_date">__delivered_date__</span></td>
        <td><span data-field="order_number">__order_number__</span></td>
        <td>$<span data-field="sum_extended_cost">__sum_extended_cost__</span></td>
        <td><span data-field="count_line_item">__count_line_item__</span></td>
    </tr>
</table>
<table id="result-table">
<thead>
<tr>
    <td>Source</td>
    <td>Delivered Date</td>
    <td>Order Number</td>
    <td>Cost</td>
    <td>Items</td>
</tr>
</thead>
<tbody id="result-table-body">
    {% for order in orders %}
        <tr class="order-row" data-source-id="{{ order.source }}" data-delivered-date="{{ order.delivered_date|date:"Y-m-d" }}"
            data-order-number="{{ order.order_number }}"
            data-order-url="{% url "inventory:sourceitem_order_items" source=order.source delivered_date=order.delivered_date|date:"Y-m-d" order_number=order.order_number|default:"nope"|urlencode %}">
            <td>{{ order.source__name }}</td>
            <td>{{ order.delivered_date|date:"M j, Y" }}</td>
            <td>{{ order.order_number }}</td>
            <td>${{ order.sum_extended_cost|floatformat:2|intcomma }}</td>
            <td>{{ order.count_line_item|intcomma }}</td>
        </tr>
    {% endfor %}
</tbody>
</table>
{% endblock %}

{% block body_scripts %}
<script src="{% static 'js/wide_filter.js' %}"></script>
<script type="application/javascript">
filter_url = "{% url "inventory:api_sourceitem_orders" %}";
filter_fields = [
    "id",
];
remove_decimals = [];
money_fields = ["sum_extended_cost"];
filter_results_div_id = "result-table-body";
filter_input_empty_if_only = [];

$(".order-row").on("click", function() {
    let e = $(this);
    window.location.assign(e.attr('data-order-url'));
});
</script>
{% endblock %}